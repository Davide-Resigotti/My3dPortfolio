<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
  </head>
  <body>

    <div class="progress-bar-container">
      <label id="label1" for="progress-bar">Nice to meet you</label>
      <label id="label2" for="progress-bar" style="display: none;">i'm Davide Resigotti</label>
      <progress id="progress-bar" value="0" max="100"></progress>
    </div>

    <nav id="navbar">
      <a href="#home">Davide Resigotti</a>
      <ul>
        <li><a href="#whoiam">Who I Am</a></li>
        <li><a href="./projects.html">Projects</a></li>
      </ul>
    </nav>

    <div class="container">
      <section id="home" class="home">
        <canvas class="room"></canvas>
      </section>

      <section id="whoiam" class="whoiam">
        <canvas class="me"></canvas>
      </section>
    </div>

    <script type="module" src="/room.js"></script>
    <script type="module" src="/me.js"></script>
    <script>
      const navLinks = document.querySelectorAll('#navbar ul a[href^="#"]');
      const brandLink = document.querySelector('#navbar > a[href="#home"]');
      const sections = Array.from(document.querySelectorAll('section[id]'));

      // Initial: highlight brand (Home) when landing without hash
      function setInitialActive() {
        navLinks.forEach(a => a.classList.remove('active'));
        if (brandLink) brandLink.classList.add('active');
      }
      if (!location.hash || location.hash === '#home') {
        setInitialActive();
      }

      const observer = new IntersectionObserver((entries) => {
        const isHomeVisible = entries.some(e => e.target.id === 'home' && e.isIntersecting);
        if (isHomeVisible) {
          navLinks.forEach(a => a.classList.remove('active'));
          if (brandLink) brandLink.classList.add('active');
          return; // prefer Home when visible
        }

        entries.forEach(entry => {
          const id = entry.target.getAttribute('id');
          if (id === 'home') return;
          const link = document.querySelector(`#navbar a[href="#${id}"]`);
          if (!link) return;
          if (entry.isIntersecting) {
            if (brandLink) brandLink.classList.remove('active');
            navLinks.forEach(a => a.classList.remove('active'));
            link.classList.add('active');
          }
        });
      }, { root: null, rootMargin: '0px 0px -60% 0px', threshold: 0.3 });

      sections.forEach(sec => observer.observe(sec));
    </script>
  </body>
</html>
